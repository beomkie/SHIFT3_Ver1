<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/user/layout/default_layout}" lang="ko">

<div layout:fragment="content" class="content">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>

	<style>
        .feed_section {
            position: relative;
            height: 100%;
        }

        .text-on-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .category {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .title {
            font-size: 2rem;
            margin-bottom: 0;
        }

        #write_section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #write_section li {
            display: inline-block;
            background-color: lightgray;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
        }

        .product-item {
            display: flex;
            align-items: center;
        }

        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 1rem;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .product-price {
            font-size: 1.2rem;
        }

        .btn-buy-now {
            background-color: white;
            border-radius: 50px;
            border: 2px solid black;
            padding: 10px 20px;
            font-weight: bold;
        }

	</style>

	<div class="feed_section">
		<img th:src="'/file/' + ${feed.thumbnailFileName}" class="img-fluid" id="banner-img"/>
		<div class="text-center text-on-image">
			<h6 class="category" id="category" th:text="${feed.category}"></h6>
			<h4 class="title" id="title" th:text="${feed.title}"></h4>
		</div>
	</div>

	<script>
        var img = document.getElementById("banner-img");
        var colorThief = new ColorThief();
        img.onload = function () {
            var centerX = img.width / 2;
            var centerY = img.height / 2;
            var sampleSize = 50;
            var canvas = document.createElement("canvas");
            canvas.width = sampleSize;
            canvas.height = sampleSize;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, centerX - sampleSize / 2, centerY - sampleSize / 2, sampleSize, sampleSize, 0, 0, sampleSize, sampleSize);
            var sampleData = ctx.getImageData(0, 0, sampleSize, sampleSize).data;
            var red = 0;
            var green = 0;
            var blue = 0;
            for (var i = 0; i < sampleData.length; i += 4) {
                red += sampleData[i];
                green += sampleData[i + 1];
                blue += sampleData[i + 2];
            }
            var numPixels = sampleSize * sampleSize;
            red = Math.floor(red / numPixels);
            green = Math.floor(green / numPixels);
            blue = Math.floor(blue / numPixels);
            var avgColor = (red + green + blue) / 3;
            console.log(avgColor)
            if (avgColor <= 128) {
                document.getElementById("category").style.color = "white";
                document.getElementById("title").style.color = "white";
            }
        }
	</script>

	<div id="column_section" class="section mb-3">
		<div class="container">
			<div id="write_section" class="mb-2">
				<h2 th:text="${feed.title}"></h2>
				<p th:text="${#temporals.format(feed.createdAt, 'yyyy.MM.dd. HH:mm 작성')}"></p>

				<p th:utext="${feed.description}">
				</p>

			</div>

			<div id="product_section" th:if="${products.size() > 0}" class="mb-3" th:each="product : ${products}">
				<div class="align-content-center justify-content-center mb-2" style="text-align: -webkit-center">
					<hr class="w-75"/>
				</div>
				<div class="product-item justify-content-center mb-3">
					<div class="product-image" th:if="${product.images.size > 0}">
						<img th:src="'/file/' + ${product.images[0].imageName}" alt="product image">
					</div>
					<div class="product-info">
						<div class="product-name" th:text="${product.name}"></div>
						<div class="product-price"
						     th:text="${product.price} + '원'"></div>
					</div>
				</div>
				<div class="text-center">
					<div class="product-description mb-4" th:text="${product.description}"></div>
					<a class="btn btn-buy-now" th:href="@{/product/{id}(id=${product.id})}">상세보기</a>
				</div>
			</div>
		</div>
	</div>

	<div id="related_section" class="mb-4">
		<div class="container">
			<h3>유사한 피드</h3>
			<hr/>

			<div class="card-group d-flex flex-wrap p-3">
				<div class="card">
					<div class="img-container43">
						<img th:src="@{/user/assets/images/banner8.jpg}" class="card-img-top rounded"
						     alt="your-image-alt">
					</div>
					<div class="card-body">
						<h5 class="card-title">컨텐츠 타이틀</h5>
						<p class="card-text">모든 국민은 직업선택의 자유를 가진다. 이 헌법시행 당시에 이 헌법에 의하여 새로 설치될 기관의 권한에 속하는 직무를 행하고 있는
							기관은 이 헌법에 의하여 새로운 기관이 설치될 때까지 존속하며 그 직무를 행한다.</p>
						<a href="#" class="btn btn-primary btn-more rounded-pill">더 알아보기</a>
					</div>
				</div>

				<div class="card">
					<div class="img-container43">
						<img th:src="@{/user/assets/images/banner9.jpg}" class="card-img-top rounded"
						     alt="your-image-alt">
					</div>
					<div class="card-body">
						<h5 class="card-title">컨텐츠 타이틀</h5>
						<p class="card-text">모든 국민은 직업선택의 자유를 가진다. 이 헌법시행 당시에 이 헌법에 의하여 새로 설치될 기관의 권한에 속하는 직무를 행하고
							있는
							기관은 이 헌법에 의하여 새로운 기관이 설치될 때까지 존속하며 그 직무를 행한다.</p>
						<a href="#" class="btn btn-primary btn-more rounded-pill">더 알아보기</a>
					</div>
				</div>

				<div class="card">
					<div class="img-container43">
						<img th:src="@{/user/assets/images/banner7.jpg}" class="card-img-top rounded"
						     alt="your-image-alt">
					</div>
					<div class="card-body">
						<h5 class="card-title">컨텐츠 타이틀</h5>
						<p class="card-text">모든 국민은 직업선택의 자유를 가진다. 이 헌법시행 당시에 이 헌법에 의하여 새로 설치될 기관의 권한에 속하는 직무를 행하고 있는
							기관은 이 헌법에 의하여 새로운 기관이 설치될 때까지 존속하며 그 직무를 행한다.</p>
						<a href="#" class="btn btn-primary btn-more rounded-pill">더 알아보기</a>
					</div>
				</div>
			</div>


			<!--			<div class="row">-->
			<!--				<div class="card mb-3 mx-3 col-3 d-flex d-md-inline-flex">-->
			<!--					<div class="img-container43">-->
			<!--						<img th:src="@{/user/assets/images/banner8.jpg}" class="card-img-top rounded"-->
			<!--						     alt="your-image-alt">-->
			<!--					</div>-->
			<!--					<div class="card-body">-->
			<!--						<h5 class="card-title">Your Product Name</h5>-->
			<!--						<p class="card-text">Preview Content</p>-->
			<!--						<button class="btn btn-outline-dark rounded">더 알아보기</button>-->
			<!--					</div>-->
			<!--				</div>-->


			<!--			</div>-->


		</div>
	</div>


</div>


</html>